<script
  src="https://cdn.jsdelivr.net/npm/@electric-sql/pglite-repl/dist-webcomponent/Repl.js"
  type="module"
></script>

<!-- Include the Repl web component in your page -->
<pglite-repl id="repl"></pglite-repl>

<script type="module">
  import { PGlite } from 'https://cdn.jsdelivr.net/npm/@electric-sql/pglite/dist/index.js'

  // Create a PGlite instance
  const pg = new PGlite()

  // Retrieve the Repl element
  const repl = document.getElementById('repl')
  
  // REPL to your PGlite instance
  repl.pg = pg

console.log("Ready!");

// Determine SQL file from URL parameter (supports ?file= or ?sql=). Default: user.sql
const params = new URLSearchParams(window.location.search);
const fileParam = params.get('file') || 'user.sql';

// If the param looks like a full URL, use it. Otherwise resolve relative to current page.
const sqlUrl = new URL(fileParam, window.location.href.split('?')[0]).href;

console.log("Loading SQL from:", sqlUrl);
try {
  const url = 'https://roeselert.github.io/pglite/user.sql'
  const response = await fetch(sqlUrl);
  if (!response.ok) {
    throw new Error(`HTTP error! Status: ${response.status}`);
  }
  const data = await response.text();
  const res = await pg.exec(data)
  console.log(res);
} catch (error) {
    console.error('Error fetching data:', error);
}
  
</script>
