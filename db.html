<script
  src="https://cdn.jsdelivr.net/npm/@electric-sql/pglite-repl/dist-webcomponent/Repl.js"
  type="module"
></script>

<!-- Include the Repl web component in your page -->
<pglite-repl id="repl"></pglite-repl>

<style>
  pglite-repl {
    display: block;
    width: 100%;
    height: 500px;

    /* Typography */
    --pglite-font-size: 12px;
  }
</style>

<script type="module">
  import { PGlite } from 'https://cdn.jsdelivr.net/npm/@electric-sql/pglite/dist/index.js'

  // Create a PGlite instance
  const pg = new PGlite()

  // Retrieve the Repl element
  const repl = document.getElementById('repl')

  // REPL to your PGlite instance
  repl.pg = pg

console.log("Ready!");

const fileParam = 'user.sql';

// If the param looks like a full URL, use it. Otherwise resolve relative to current page.
const sqlUrl = new URL(fileParam, window.location.href.split('?')[0]).href;

console.log("Loading SQL from:", sqlUrl);
try {

  const response = await fetch(sqlUrl);
  if (!response.ok) {
    throw new Error(`HTTP error! Status: ${response.status}`);
  }
  const data = await response.text();
  const res = await pg.exec(data)
  console.log(res);
} catch (error) {
    console.error('Error fetching data:', error);
}
  
</script>

<script>
 // Arrow Up
const upEvent = new KeyboardEvent('keydown', {
  key: 'ArrowUp',
  code: 'ArrowUp',
  keyCode: 38,
  which: 38,
  bubbles: true
});

// Arrow Down
const downEvent = new KeyboardEvent('keydown', {
  key: 'ArrowDown',
  code: 'ArrowDown',
  keyCode: 40,
  which: 40,
  bubbles: true
});

// Arrow Left
const leftEvent = new KeyboardEvent('keydown', {
  key: 'ArrowLeft',
  code: 'ArrowLeft',
  keyCode: 37,
  which: 37,
  bubbles: true
});

// Arrow Right
const rightEvent = new KeyboardEvent('keydown', {
  key: 'ArrowRight',
  code: 'ArrowRight',
  keyCode: 39,
  which: 39,
  bubbles: true
});

// Tab
const tabEvent = new KeyboardEvent('keydown', {
  key: 'Tab',
  code: 'Tab',
  keyCode: 9,
  which: 9,
  bubbles: true
});

// Ctrl+V
const pasteEvent = new KeyboardEvent('keydown', {
  key: 'v',
  code: 'KeyV',
  keyCode: 86,
  which: 86,
  ctrlKey: true,
  bubbles: true
});

  
 
  function sendKey(event) {
    const element = document.querySelector('#repl').shadowRoot.querySelectorAll('.cm-line')
    element[0].dispatchEvent(event)
  }
</script>

<div style="
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  margin-bottom:14px;
  max-width:260px;
">
  <button style="font-size:22px; padding:14px 22px;" onclick="sendKey(tabEvent)">Tab</button>
  <button style="font-size:22px; padding:14px 22px;" onclick="sendKey(upEvent)">↑</button>
  <button style="font-size:22px; padding:14px 22px;" onclick="sendKey(pasteEvent)">c+v</button>
  <button style="font-size:22px; padding:14px 22px;" onclick="sendKey(leftEvent)">←</button>
  <button style="font-size:22px; padding:14px 22px;" onclick="sendKey(downEvent)">↓</button>
  <button style="font-size:22px; padding:14px 22px;" onclick="sendKey(rightEvent)">→</button>
</div> 

